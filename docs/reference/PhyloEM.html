<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Model Estimation with Detection of Shifts — PhyloEM • PhylogeneticEM</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>

<!-- mathjax -->
<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">PhylogeneticEM</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../articles/tutorial.html">Tutorial</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/pbastide/PhylogeneticEM">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Model Estimation with Detection of Shifts</h1>
    </div>

    
    <p><code>PhyloEM</code> is the main function of the package. It uses maximum likelihood
methods to fit a BM or an OU process for several traits evolving along a
phylogenetic tree, with automatic shift detection on the branches of the tree.
This function can handle missing data.</p>
    

    <pre><span class='fu'>PhyloEM</span>(<span class='no'>phylo</span>, <span class='no'>Y_data</span>, <span class='kw'>process</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"BM"</span>, <span class='st'>"OU"</span>, <span class='st'>"scOU"</span>, <span class='st'>"rBM"</span>),
  <span class='kw'>check_postorder</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>independent</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>K_max</span> <span class='kw'>=</span> <span class='fu'>max</span>(<span class='fu'>floor</span>(<span class='fu'>sqrt</span>(<span class='fu'>length</span>(<span class='no'>phylo</span>$<span class='no'>tip.label</span>))), <span class='fl'>10</span>),
  <span class='kw'>use_previous</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>order</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>method.selection</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"LINselect"</span>,
  <span class='st'>"DDSE"</span>, <span class='st'>"Djump"</span>), <span class='kw'>C.BM1</span> <span class='kw'>=</span> <span class='fl'>0.1</span>, <span class='kw'>C.BM2</span> <span class='kw'>=</span> <span class='fl'>2.5</span>, <span class='kw'>C.LINselect</span> <span class='kw'>=</span> <span class='fl'>1.1</span>,
  <span class='kw'>method.variance</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"upward_downward"</span>, <span class='st'>"simple"</span>), <span class='kw'>method.init</span> <span class='kw'>=</span> <span class='st'>"lasso"</span>,
  <span class='kw'>method.init.alpha</span> <span class='kw'>=</span> <span class='st'>"estimation"</span>,
  <span class='kw'>method.init.alpha.estimation</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"regression"</span>, <span class='st'>"regression.MM"</span>, <span class='st'>"median"</span>),
  <span class='kw'>methods.segmentation</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"lasso"</span>, <span class='st'>"best_single_move"</span>), <span class='kw'>alpha_grid</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>nbr_alpha</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>random.root</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>stationary.root</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>alpha</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>check.tips.names</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>progress.bar</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>estimates</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>save_step</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>parallel_alpha</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>Ncores</span> <span class='kw'>=</span> <span class='fl'>3</span>, <span class='kw'>impute_init_Rphylopars</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>K_lag_init</span> <span class='kw'>=</span> <span class='fl'>5</span>,
  <span class='kw'>light_result</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <dl class="dl-horizontal">
      <dt>phylo</dt>
      <dd>A phylogenetic tree of class <code>phylo</code> 
(from package <code>ape</code>).</dd>
      <dt>Y_data</dt>
      <dd>Matrix of data at the tips, size p x ntaxa. Each line is a
trait, and each column is a tip. The column names are checked against the
tip names of the tree.</dd>
      <dt>process</dt>
      <dd>The model used for the fit. One of &quot;BM&quot; (for a full BM model, 
univariate or multivariate); &quot;OU&quot; (for an OU with independent traits, 
univariate or multivariate); or &quot;scOU&quot; (for a &quot;scalar OU&quot; model, see details).</dd>
      <dt>check_postorder</dt>
      <dd>Re-order the tree in post-order. If the Upward-Downward
algorithm is used, the tree need to be in post-order. Default to TRUE if the
upward-downward is used, otherwise automatically set to FALSE.</dd>
      <dt>independent</dt>
      <dd>Are the trait assumed to be independent from one another?
Default to FALSE. OU in a multivariate setting only works if TRUE.</dd>
      <dt>K_max</dt>
      <dd>The maximum number of shifts to be considered. Default to 
\(max(|\sqrt ntaxa|, 10)\).</dd>
      <dt>use_previous</dt>
      <dd>Should the initialization for K+1 shifts use the 
estimation for $K$ shifts already obtained? Default to FALSE.</dd>
      <dt>order</dt>
      <dd>Should the estimations be done for K increasing (TRUE) or K
decreasing (FALSE)? If use_previous=FALSE, this has no influence, exept if one
initialization fails. Default to TRUE.</dd>
      <dt>method.selection</dt>
      <dd>Method selection to be used. Several ones can be
used at the same time. One of &quot;LINselect&quot; for the Baraud Giraud Huet LINselect 
method; &quot;DDSE&quot; for the Slope Heuristic or &quot;Djump&quot; for the Jump Heuristic, last
two based the Birgé Massart method.</dd>
      <dt>C.BM1</dt>
      <dd>Multiplying constant to be used for the BigeMassart1 method.
Need to be positive. Default to 0.1.</dd>
      <dt>C.BM2</dt>
      <dd>Multiplying constant to be used for the BigeMassart2 method.
Default to 2.5.</dd>
      <dt>C.LINselect</dt>
      <dd>Multiplying constant to be used for the LINselect method.
Need to be greater than 1. Default to 1.1.</dd>
      <dt>method.variance</dt>
      <dd>Algorithm to be used for the moments computations at the
E step. One of &quot;simple&quot; for the naive method; of &quot;upward_downward&quot; for the 
Upward Downward method (usually faster). Default to &quot;upward_downward&quot;.</dd>
      <dt>method.init</dt>
      <dd>The initialization method. One of &quot;lasso&quot; for the LASSO
base initialization method; or &quot;default&quot; for user-specified initialization
values. Default to &quot;lasso&quot;.</dd>
      <dt>method.init.alpha</dt>
      <dd>For OU model, initialisation method for the selection
strength alpha. One of &quot;estimation&quot; for a cherry-based initialization, using
<code><a href='http://www.rdocumentation.org/packages/robustbase/topics/nlrob'>nlrob</a></code>; or &quot;default&quot; for user-specified 
initialization values. Default to &quot;estimation&quot;.</dd>
      <dt>method.init.alpha.estimation</dt>
      <dd>If method.init.alpha=&quot;estimation&quot;,
choice of the estimation(s) methods to be used. Choices among &quot;regression&quot;,
(method=&quot;M&quot; is passed to <code><a href='http://www.rdocumentation.org/packages/robustbase/topics/nlrob'>nlrob</a></code>); &quot;regression.MM&quot;
(method=&quot;MM&quot; is passed to <code><a href='http://www.rdocumentation.org/packages/robustbase/topics/nlrob'>nlrob</a></code>) or &quot;median&quot;
(<code><a href='http://www.rdocumentation.org/packages/robustbase/topics/nlrob'>nlrob</a></code> is not used, a simple median is taken).
Default to all of them.</dd>
      <dt>methods.segmentation</dt>
      <dd>For OU, method(s) used at the M step to find new
candidate shifts positions. Choices among &quot;lasso&quot; for a LASSO-based algorithm;
and &quot;best_single_move&quot; for a one-move at a time based heuristic. Default to 
both of them. Using only &quot;lasso&quot; might speed up the function a lot.</dd>
      <dt>alpha_grid</dt>
      <dd>Wether to use a grid for alpha values. Default to TRUE. This
is the only available method for scOU. This method is not available for OU with
multivariate traits. OU with univariate traits can take both TRUE or FALSE. If
TRUE, a grid based on the branch length of the tree is automatically computed,
using function <code><a href='find_grid_alpha.html'>find_grid_alpha</a></code>.</dd>
      <dt>nbr_alpha</dt>
      <dd>If <code>alpha_grid=TRUE</code>, the number of alpha values on the
grid. Default to 10.</dd>
      <dt>random.root</dt>
      <dd>Wether the root is assumed to be random (TRUE) of fixed
(FALSE). Default to TRUE</dd>
      <dt>stationary.root</dt>
      <dd>Wether the root is assumed to be in the stationnary 
state. Default to TRUE.</dd>
      <dt>alpha</dt>
      <dd>If the estimation is done with a fixed alpha (either known, or
on a grid), the possible value for alpha. Default to NULL.</dd>
      <dt>check.tips.names</dt>
      <dd>Wether to check the tips names of the tree against
the column names of the data. Default to TRUE.</dd>
      <dt>progress.bar</dt>
      <dd>Wether to display a progress bar of the computations.
Default to TRUE.</dd>
      <dt>estimates</dt>
      <dd>The result of a previous run of this same function. This
function can be re-run for other model election method. Default to NULL.</dd>
      <dt>save_step</dt>
      <dd>If alpha_grid=TRUE, wether to save the intermediate results
for each value of alpha (in a temporary file). Useful for long computations.
Default to FALSE.</dd>
      <dt>parallel_alpha</dt>
      <dd>If alpha_grid=TRUE, wether to run the 
estimations with different values of alpha on separate cores. Default to 
FALSE. If TRUE, the log is written as a temporary file.</dd>
      <dt>Ncores</dt>
      <dd>If parallel_alpha=TRUE, number of cores to be used.</dd>
      <dt>impute_init_Rphylopars</dt>
      <dd>Wether to use 
<code><a href='http://www.rdocumentation.org/packages/Rphylopars/topics/Rphylopars-package'>Rphylopars-package</a></code> for initialization. 
Default to FALSE.</dd>
      <dt>K_lag_init</dt>
      <dd>Number of extra shifts to be considered at the initialization
step. Increases the accuracy, but can make computations quite slow of taken
too high. Default to 5.</dd>
      <dt>light_result</dt>
      <dd>if TRUE (the default), the object returned is enlighted,
without easilly computatble quantities. If FALSE, the object can be very heavy, but
its subsequent manipulations can be faster (especially for plotting).</dd>
      <dt>...</dt>
      <dd>Further arguments to be passed to <code><a href='estimateEM.html'>estimateEM</a></code>, including
tolerance parameters for stopping criterions, maximal number of iterations, etc.</dd>
    </dl>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An object of class <code>PhyloEM</code>. Relevent quantities can be extracted from it 
using helper functions <code><a href='params_process.PhyloEM.html'>params_process.PhyloEM</a></code>,
<code><a href='imputed_traits.html'>imputed_traits.PhyloEM</a></code></p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Several models can be used:
<ul>
<li> BM with fixed root, univariate or multivariate.
</li>
<li> OU with fixed or stationary root, univariate or multivariate.
</li>
</ul></p>
    <p>For the OU in the multivariate setting, two assumptions can be made:
<ul>
<li> Independent traits. This amounts to digonal rate and selection matrices.
</li>
<li> &quot;Scalar OU&quot; (scOU): the rate matrix can be full, but the selection 
strength matrix is assumed to be scalar, i.e. all the traits are supposed to
go to their optimum values with the same speed.
</li>
</ul></p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code><a href='plot.PhyloEM.html'>plot.PhyloEM</a></code>, <code><a href='params_process.PhyloEM.html'>params_process.PhyloEM</a></code>,
<code><a href='imputed_traits.html'>imputed_traits.PhyloEM</a></code></p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## Not run: ------------------------------------</span>
<span class='co'># ## Load Data</span>
<span class='co'># data(monkeys)</span>
<span class='co'># ## Run method</span>
<span class='co'># # Note: use more alpha values for better results.</span>
<span class='co'># res &lt;- PhyloEM(Y_data = monkeys$dat,        ## data</span>
<span class='co'>#                phylo = monkeys$phy,         ## phylogeny</span>
<span class='co'>#                process = "scOU",            ## scalar OU</span>
<span class='co'>#                random.root = TRUE,          ## root is stationary</span>
<span class='co'>#                stationary.root = TRUE,</span>
<span class='co'>#                K_max = 10,                  ## maximal number of shifts</span>
<span class='co'>#                nbr_alpha = 4,               ## number of alpha values</span>
<span class='co'>#                parallel_alpha = TRUE,       ## parallelize on alpha values</span>
<span class='co'>#                Ncores = 2)</span>
<span class='co'># ## Plot selected solution (LINselect)</span>
<span class='co'># plot(res) # three shifts</span>
<span class='co'># ## Plot selected solution (DDSE)</span>
<span class='co'># plot(res, method.selection = "DDSE") # no shift</span>
<span class='co'># ## Extract and solution with 5 shifts</span>
<span class='co'># params_5 &lt;- params_process(res, K = 5)</span>
<span class='co'># plot(res, params = params_5)</span>
<span class='co'># ## Show all equivalent solutions</span>
<span class='co'># eq_sol &lt;- equivalent_shifts(monkeys$phy, params_5)</span>
<span class='co'># plot(eq_sol)</span>
<span class='co'>## ---------------------------------------------</span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Paul Bastide.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
